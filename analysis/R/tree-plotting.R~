## Code for plotting fusions

library(diversitree)

col.tree <- list(G=c("#86B8B1","#FA2A00"), K=c("white", "#3D1C00","#F2D694"))


## Read in raw datastes
dat.all <- read.csv("datasets/vert.data-may19.csv")

## fix species names
dat.all$species <- sapply(dat.all$species, function(x)
                        gsub("[-]", replacement="", x))
dat.all$species <- sapply(dat.all$species, function(x)
                        gsub("*([0-9])", replacement="", x))

## add new column with full name
dat.all$binom <- sapply(seq_len(nrow(dat.all)), function(x) paste(dat.all[x,"Genus"], dat.all[x, "species"], sep="_"))

## change karyotype column heading
k <- grep("Karyotype", colnames(dat.all))[1]
colnames(dat.all)[k] <- "karyotype"

notes <- grep("notes", colnames(dat.all))
colnames(dat.all)[notes] <- "notes"



## ## Fish
dat.fish <- subset(dat.all, Higher.taxonomic.group == "Fish")

## How many Y-A fusions
ya.fish <- grep("X2", dat.fish$notes)
names(ya.fish) <- dat.fish$binom[ya.fish]
het.y <- sapply(names(ya.fish), function(x) {strsplit(x, split=" ")[[1]][1]})

## How many X-A fusions
xa.fish <- grep("Y2", dat.fish$notes)
names(xa.fish) <- dat.fish$binom[xa.fish]
hom.x <- sapply(names(xa.fish), function(x) {strsplit(x, split=" ")[[1]][1]})

## How many Z-A fusions
za.fish <- grep("W2", dat.fish$notes)
names(za.fish) <- dat.fish$binom[za.fish]
hom.z <- sapply(names(za.fish), function(x) {strsplit(x, split=" ")[[1]][1]})

## How many W-A fusions
wa.fish <- grep("Z2", dat.fish$notes)
names(wa.fish) <- dat.fish$binom[wa.fish]
het.w <- sapply(names(wa.fish), function(x) {strsplit(x, split=" ")[[1]][1]})

## read in tree matched data
fdat <- readRDS("output/data/fish.rds")

fphy <- fdat$phy
fdat <- as.data.frame(fdat$data)

for (i in seq_len(nrow(fdat))){
    if (fdat[i,"K"] == 1){
        if (rownames(fdat)[i] %in% c(hom.x, hom.z))
            fdat[i, "K"] <- 2
    }
}

genus.fish <- sub("_.+$", "", fphy$tip.label)
trait.plot(ladderize(fphy), dat=fdat, cols=col.tree,
           lab=c("Genotype", "Fused"),
           str=list(c("XY", "ZW"), c("None", "Het. Chrom", "Hom. Chrom")),
           class=genus.fish, quiet=TRUE, w=1/10, margin=1/1.4, cex.legend = 1)

